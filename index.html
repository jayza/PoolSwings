<!DOCTYPE html>
<html>
<head>
  <title></title>
</head>
<body>
<div id="wrapper"></div>
<script type="text/javascript">
  function hasOwnProperty(obj, prop) {
      var proto = obj.__proto__ || obj.constructor.prototype;
      return (prop in obj) &&
          (!(prop in proto) || proto[prop] !== obj[prop]);
  }

  /**
   * Player class.
   */
  var Player = function() {
    this.players = new Array();
  }

  Player.prototype = {
    /**
     * Create a player.
     */
    create: function(playerObj) {
      if (typeof playerObj == "object") {
        var player = {};

        player.id = this.players.length;
        player.name = null;

        for (var prop in playerObj) {
          if (hasOwnProperty(player, prop)) {
            player[prop] = playerObj[prop];
          }
        }

        this.players.push(player);
      } else {
        console.log('You have to provide an object with information');
      }
    }
  }

  var players = new Player();

  players.create({name: 'Jake'});
  players.create({name: 'Jonathan'});
  players.create({name: 'Katie'});
  players.create({name: 'John'});

  /**
   * Class to create a tournament.
   * @param playerClass object Player class with players in it.
   */
  var Tournament = function(playerClass) {
    // Check to see if it really is a Player class.
    if (typeof playerClass == "object") {
      if (hasOwnProperty(playerClass, 'players')) {
        this.players = (playerClass.players.length > 0) ? playerClass.players : new Array();
      }
    } else {
      this.players = new Array();
    }
    
    this.matches = new Array();

    // temporary mode
    this.mode = 'roundrobin';

    this.currentRound = 0;

    this.wrapper = document.getElementById('wrapper');

    this.create();
  }

  Tournament.prototype = {
    /**
     * Create the tournament and add players.
     */
    create: function() {
      var nPlayers = this.players.length;

      if (nPlayers == 0) {
        nPlayers = parseInt(prompt('How many?'));

        // @todo fix better way to check if prompt gives an int.
        if (typeof nPlayers == "number") {
          for (var i = 0; i < nPlayers; i++) {
            var player = {};

            player.id = i;
            player.name = prompt('Name of player ' + (i + 1));

            this.players.push(player);
          } 
        } else {
          console.log('you have to enter an integer.');
          return false;
        }
      }

      if (this.players.length == nPlayers) {
          return this.createMatches();  
        } else {
          return false;
        }
    },
    /**
     * Initialize match setup.
     */
    createMatches: function() {
      if (this.mode == 'roundrobin') {
        if (this.roundrobin()) {
          this.renderMatches();
        }
      }
    },
    /**
     * Render the matches in the DOM.
     */
    renderMatches: function() {
      if (document.getElementById('match-table')) {
        document.getElementById('match-table').remove();
      }

      var matchTable = document.createElement('table');
          matchTable.setAttribute('id', 'match-table');

      for (var i = 0; i < this.matches.length; i++) {
        var match = document.createElement('tr');
            match.className = 'match';

        var title = document.createElement('td');
            title.className = 'title';

            title.innerHTML = this.matches[i].title;

        match.appendChild(title);

        var score = document.createElement('td'),
            winner = 'TBD';
            score.className = 'score';
              
        if (this.matches[i].winnerId != null) {
          winner = this.players[this.matches[i].winnerId].name;
        }

        score.innerHTML = winner;

        match.appendChild(score);

        matchTable.appendChild(match);
      }

      this.wrapper.appendChild(matchTable);
    },
    /**
     * Set winner for a match
     */
    updateMatch: function(matchObj) {
      if (typeof matchObj == "object") {
        var id = matchObj.id;
        console.log('Updating match with id ' + id);
        for (var prop in matchObj) {
          // Check if the property of the update object exists in the match object.
          if (hasOwnProperty(this.matches[id], prop)) {
            this.matches[id][prop] = matchObj[prop];
          }
        }
        console.log('Updated ', this.matches[id]);

        this.renderMatches();
      } else {
        return false;
      }
    },
    /**
     * Game Modes.
     */
    roundrobin: function() {
      for (var i = 0; i < this.players.length; i++) {
        for (var j = 0; j < this.players.length; j++) {
          if (j == i) continue;

          // Check to see whether to add match depending on if already match exists.
          if (this.matches.length > 0) {
            var matchExists = false;
            for (var k = 0; k < this.matches.length; k++) {
              if (this.matches[k].playerIds.indexOf(i) >= 0 && this.matches[k].playerIds.indexOf(j) >= 0) {
                matchExists = true;
              }
            }

            if (matchExists) continue;
          }

          // Add match settings.
          var match = {};

          match.id        = this.matches.length;
          match.playerIds = [this.players[i].id, this.players[j].id];
          match.winnerId  = null;
          match.round     = this.currentRound;
          match.title     = this.players[i].name + ' vs. ' + this.players[j].name;

          this.matches.push(match);
        }
      }

      return true;
    }
  }

  var tmnt = new Tournament(players);
</script>
</body>
</html>